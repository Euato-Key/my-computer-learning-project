# Git æ’¤é”€ Commit æ“ä½œç¬”è®°

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### å·¥ä½œåŒº â†’ æš‚å­˜åŒº â†’ æœ¬åœ°ä»“åº“ â†’ è¿œç¨‹ä»“åº“
```
å·¥ä½œåŒº (ä¿®æ”¹æ–‡ä»¶) â†’ git add â†’ æš‚å­˜åŒº â†’ git commit â†’ æœ¬åœ°ä»“åº“ â†’ git push â†’ è¿œç¨‹ä»“åº“
```

## ğŸ”„ æ’¤é”€ä¸åŒç±»å‹çš„ä¿®æ”¹

### 1. æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹ï¼ˆæœª `git add`ï¼‰
```bash
# æ’¤é”€å•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹
git checkout -- filename

# æ’¤é”€æ‰€æœ‰ä¿®æ”¹ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
git checkout -- .
```

### 2. æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹ï¼ˆå·² `git add`ï¼Œæœª `git commit`ï¼‰
```bash
# å°†æ–‡ä»¶ä»æš‚å­˜åŒºæ’¤å›å·¥ä½œåŒºï¼ˆä¿ç•™ä¿®æ”¹ï¼‰
git reset HEAD filename

# å°†æ‰€æœ‰æ–‡ä»¶ä»æš‚å­˜åŒºæ’¤å›
git reset HEAD .
```

### 3. æ’¤é”€æœ¬åœ°æäº¤ï¼ˆå·² `git commit`ï¼Œæœª `git push`ï¼‰

#### æ–¹æ³•ä¸€ï¼š`git reset`ï¼ˆä¿®æ”¹å†å²ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
```bash
# è½¯é‡ç½®ï¼šæ’¤é”€commitä½†ä¿ç•™ä¿®æ”¹å†…å®¹åœ¨æš‚å­˜åŒº
git reset --soft HEAD~1

# æ··åˆé‡ç½®ï¼ˆé»˜è®¤ï¼‰ï¼šæ’¤é”€commitï¼Œä¿®æ”¹å†…å®¹ä¿ç•™åœ¨å·¥ä½œåŒº
git reset --mixed HEAD~1

# ç¡¬é‡ç½®ï¼šå½»åº•åˆ é™¤commitå’Œæ‰€æœ‰ä¿®æ”¹ï¼ˆè°¨æ…ï¼ï¼‰
git reset --hard HEAD~1

# é‡ç½®åˆ°ç‰¹å®šcommit
git reset --hard commit_id
```

#### æ–¹æ³•äºŒï¼š`git revert`ï¼ˆåˆ›å»ºæ–°æäº¤æ¥æ’¤é”€æ›´æ”¹ï¼‰
```bash
# æ’¤é”€æœ€è¿‘ä¸€æ¬¡æäº¤
git revert HEAD

# æ’¤é”€ç‰¹å®šæäº¤
git revert commit_id

# æ’¤é”€å¤šä¸ªè¿ç»­æäº¤
git revert older_commit_id^..newer_commit_id
```

## ğŸ“Š Reset ä¸‰ç§æ¨¡å¼çš„å¯¹æ¯”

| æ¨¡å¼ | å‘½ä»¤ | å½±å“æäº¤å†å² | å½±å“æš‚å­˜åŒº | å½±å“å·¥ä½œåŒº |
|------|------|-------------|-----------|-----------|
| --soft | `git reset --soft HEAD~1` | âœ… æ’¤é”€ | âŒ ä¿ç•™ | âŒ ä¿ç•™ |
| --mixed | `git reset --mixed HEAD~1` | âœ… æ’¤é”€ | âœ… æ’¤é”€ | âŒ ä¿ç•™ |
| --hard | `git reset --hard HEAD~1` | âœ… æ’¤é”€ | âœ… æ’¤é”€ | âœ… æ’¤é”€ |

## ğŸš¨ é‡è¦æ³¨æ„äº‹é¡¹

### 1. å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“çš„æ’¤é”€
```bash
# å¦‚æœå·²ç»pushï¼Œéœ€è¦å¼ºåˆ¶æ¨é€ï¼ˆè°¨æ…ï¼ä¼šè¦†ç›–è¿œç¨‹å†å²ï¼‰
git push --force

# æ›´å®‰å…¨çš„å¼ºåˆ¶æ¨é€ï¼ˆé€‚ç”¨äºå›¢é˜Ÿåä½œï¼‰
git push --force-with-lease
```

### 2. æ‰¾å›è¯¯åˆ çš„æäº¤
```bash
# æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„commitï¼‰
git reflog

# ä»reflogä¸­æ‰¾åˆ°commit hashï¼Œç„¶åé‡ç½®å›å»
git reset --hard commit_hash_from_reflog
```

### 3. ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤çš„ä¿¡æ¯
```bash
# åªä¿®æ”¹æäº¤ä¿¡æ¯
git commit --amend

# ä¿®æ”¹æäº¤ä¿¡æ¯å’Œå†…å®¹
git add .  # æ·»åŠ æ–°ä¿®æ”¹
git commit --amend
```

## ğŸ¯ å®ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šæ’¤é”€æœ€è¿‘ä¸€æ¬¡æäº¤ä½†ä¿ç•™ä¿®æ”¹
```bash
git reset --soft HEAD~1
```

### åœºæ™¯2ï¼šå®Œå…¨æ’¤é”€æœ€è¿‘ä¸€æ¬¡æäº¤å’Œæ‰€æœ‰ä¿®æ”¹
```bash
git reset --hard HEAD~1
```

### åœºæ™¯3ï¼šæ’¤é”€ç‰¹å®šæ–‡ä»¶çš„ä¸Šæ¬¡æäº¤
```bash
git checkout HEAD~1 -- path/to/file
```

### åœºæ™¯4ï¼šå®‰å…¨åœ°æ’¤é”€å·²æ¨é€çš„æäº¤ï¼ˆå›¢é˜Ÿåä½œï¼‰
```bash
git revert commit_id
git push  # ä¸éœ€è¦force
```

### åœºæ™¯5ï¼šä¿®æ”¹ä¸Šæ¬¡æäº¤çš„æ¶ˆæ¯
```bash
git commit --amend
# ç¼–è¾‘æäº¤æ¶ˆæ¯åä¿å­˜
git push --force-with-lease  # å¦‚æœå·²æ¨é€
```

## âš ï¸ å®‰å…¨è­¦å‘Š

1. **ä¸è¦å¯¹å·²å…±äº«çš„æäº¤ä½¿ç”¨ `git reset --hard`**ï¼ˆä¼šç ´åå›¢é˜Ÿåä½œï¼‰
2. **ä½¿ç”¨ `--force-with-lease` è€Œä¸æ˜¯ `--force`**ï¼ˆæ›´å®‰å…¨ï¼‰
3. **é‡è¦ä¿®æ”¹å‰å…ˆå¤‡ä»½åˆ†æ”¯**ï¼š
   ```bash
   git branch backup-branch-name
   ```
4. **ä½¿ç”¨ `git reflog` æ˜¯æœ€åçš„æ•‘å‘½ç¨»è‰**

## ğŸ” æŸ¥çœ‹å†å²è®°å½•

```bash
# æŸ¥çœ‹ç®€æ´æäº¤å†å²
git log --oneline -10

# æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•ï¼ˆåŒ…æ‹¬resetç­‰ï¼‰
git reflog -10

# æŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹å†å²
git log -p filename
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å°æ­¥æäº¤**ï¼šé¢‘ç¹æäº¤å°ä¿®æ”¹ï¼Œå‡å°‘éœ€è¦æ’¤é”€çš„èŒƒå›´
2. **å…ˆ revert å reset**ï¼šå¯¹å·²æ¨é€çš„æäº¤ä¼˜å…ˆä½¿ç”¨ revert
3. **å¤‡ä»½é‡è¦åˆ†æ”¯**ï¼šåœ¨è¿›è¡Œé‡å¤§æ“ä½œå‰åˆ›å»ºå¤‡ä»½åˆ†æ”¯
4. **å›¢é˜Ÿæ²Ÿé€š**ï¼šå¼ºåˆ¶æ¨é€å‰é€šçŸ¥å›¢é˜Ÿæˆå‘˜

è®°ä½ï¼š**`revert` æ˜¯å®‰å…¨çš„ï¼Œ`reset` æ˜¯å±é™©çš„**ï¼ˆç‰¹åˆ«æ˜¯å·²æ¨é€çš„æäº¤ï¼‰ï¼